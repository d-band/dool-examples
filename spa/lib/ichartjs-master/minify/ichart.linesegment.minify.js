iChart.LineSegment=iChart.extend(iChart.Component,{configure:function(){iChart.LineSegment.superclass.configure.apply(this,arguments);this.type="linesegment";this.set({brushsize:1,intersection:!0,label:{},sign:"round",area_color:null,hollow:!0,hollow_inside:!0,hollow_color:"#FEFEFE",smooth:!1,smoothing:1.5,point_size:6,points:[],keep_with_coordinate:!1,shadow_blur:1,shadow_offsety:1,point_space:0,coordinate:null,event_range_x:0,limit_y:!1,tip_offset:2,event_range_y:0});this.registerEvent("parseText");this.tip=null},drawSegment:function(){var a=this._();a.polygons.each(function(d){a.T.polygon.apply(a.T,d)});a.T.shadowOn(a.get("shadow"));a.lines.each(function(d){a.T.lineArray.apply(a.T,d)});a.intersections.each(function(d){a.sign_plugin?a.sign_plugin_fn.apply(a,d):a.T.round0.apply(a.T,d)});a.get("shadow")&&a.T.shadowOff()},doDraw:function(a){a.drawSegment();a.get("label")&&a.labels.each(function(a){a.draw()})},isEventValid:function(){},tipInvoke:function(){var a=this.x,d=this.get("tip_offset"),f=this.get("point_size")+d,g=this;return function(b,h,e){var i=e.left,e=e.top,i=3>g.tipPosition&&0<i-b-a-d||2<g.tipPosition&&0>i-b-a-d?i-(b+d):i+d,e=0==g.tipPosition%2?e+f:e-h-f;return{left:i,top:e}}},PP:function(a,d,f,g,b,h){a.get("area")&&a.polygons.push([a.get("area_color")||a.get("light_color2"),0,a.get("brushsize"),0,0,a.get("area_opacity"),a.get("smooth")?d:[{x:f,y:g}].concat(d.concat([{x:b,y:h}])),a.get("smooth"),a.get("smoothing")||1.5,[{x:f,y:g},{x:b,y:h}]])},parse:function(a){a.polygons=[];a.lines=[];a.intersections=[];a.labels=[];var d=a.get("points"),f=a.get("intersection"),g=!!a.get("label"),b=[],h=!1,e=a.get("smooth"),i=a.get("smoothing")||1.5,j=a.get("f_color"),k=a.get("brushsize"),l=a.get("point_size");if(f){var n=a.getPlugin("sign"),m=j,o=a.get("hollow_color");a.sign_plugin=iChart.isFunction(n);a.sign_plugin_fn=n;a.get("hollow_inside")&&(m=o,o=j)}d.each(function(c){c.x_=c.x;c.y_=c.y;!c.ignored&&g&&(a.push("label.originx",c.x),a.push("label.originy",c.y-l/2-1),a.push("label.text",a.fireString(a,"parseText",[a,c.value],c.value)),iChart.applyIf(a.get("label"),{textBaseline:"bottom",color:a.get("f_color")}),a.labels.push(new iChart.Text(a.get("label"),a)));c.ignored&&h?(a.lines.push([b,k,j,e,i]),a.PP(a,b,b[0].x,a.y,b[b.length-1].x,a.y),b=[],h=!1):c.ignored||(b.push(c),h=!0);f&&!c.ignored&&a.intersections.push(a.sign_plugin?[a.T,a.get("sign"),c,l,c.color||m,c.hollow_color||o]:a.get("hollow")?[c,l/2-k+1,c.color||m,k+1,c.hollow_color||o]:[c,l/2,c.color||m])});b.length&&(a.lines.push([b,k,j,e,i]),a.PP(a,b,b[0].x,a.y,b[b.length-1].x,a.y))},doConfig:function(){iChart.LineSegment.superclass.doConfig.call(this);iChart.Assert.isTrue(0<this.get("point_space"),"point_space");var a=this._(),d=3*a.get("point_size")/2,f=a.get("point_space"),g=a.get("event_range_y"),b=a.get("event_range_x"),h=a.get("tipInvokeHeap"),e=a.get("points"),i=a.get("name");a.parse(a);if(0>=b||b>f/2)b=a.push("event_range_x",f/2);0==g&&(g=a.push("event_range_y",d/2));a.get("tip.enable")&&(a.on("mouseover",function(){h.push(a);a.tipPosition=h.length}).on("mouseout",function(){h.pop()}),a.push("tip.invokeOffsetDynamic",!0),a.tip=new iChart.Tip(a.get("tip"),a));var j=a.get("coordinate"),k=a.get("limit_y"),l=a.get("keep_with_coordinate"),n=function(a,c,d){return!a.ignored&&Math.abs(c-a.x)<b&&(!k||k&&Math.abs(d-a.y)<g)?true:false},m=function(a){return{valid:true,name:i,value:e[a].value,text:e[a].text,top:e[a].y,left:e[a].x,i:a,hit:true}};a.isEventValid=function(b){if(j&&!j.isEventValid(b,j).valid)return{valid:false};var c=Math.floor((b.x-a.x)/f);if(c<0||c>=e.length-1){c=iChart.between(0,e.length-1,c);return n(e[c],b.x,b.y)?m(c):{valid:l}}for(var d=c;d<=c+1;d++)if(n(e[d],b.x,b.y))return m(d);return{valid:l}}}});